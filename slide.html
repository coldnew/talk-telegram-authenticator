<!DOCTYPE html>
<html>
<head>
<title></title>
<!-- 2016-09-13 Tue 14:40 -->
<meta  charset="utf-8" />
<meta  htto-equiv="X-UA-Compatible" content="chrome=1" />
<meta  name="generator" content="Org-mode with org-ioslide" />
<meta  name="author" content="Yen-Chin, Lee &lt;coldnew&gt;" />


<!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
<!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--This one seems to work all the time, but really small on ipad-->
<!--<meta name="viewport" content="initial-scale=0.4">-->
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="stylesheet" media="all" href="theme/css/default.css" />
<link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css" />
<link rel="stylesheet" media="all" href="theme/css/small-icon.css" />
<base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
<script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
<link rel="stylesheet" type="text/css" href="theme/slide.css"/>
<script src="js/jquery-1.7.1.min.js"> </script>
<script src="theme/app.js"></script>

   <script src="js/jquery-1.7.1.min.js" type="text/javascript"></script>

<script src="js/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML,local/local" type="text/javascript"></script>
</head>
<body style="opacity: 0">
<slides class="layout-widescreen">
<slide class="title-slide segue nobackground">
       <aside class="gdbar"><img src="images/telegram-icon.png"></aside>
       <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
       <hgroup class="auto-fadein">
         <h1 data-config-title><!-- populated from slide_config.json --></h1>
         <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
         <p data-config-presenter><!-- populated from slide_config.json --></p>
       </hgroup>
    </slide>
  
<slide id="sec-" class=" segue dark quote nobackground" style="background-image: url(nil)">
<aside class="gdbar right bottom"><img src="images/telegram-icon.png"></aside><hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline5" class="outline-2">
<h2 id="orgheadline5">The Idea</h2>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="flexbox vleft auto-fadein" id="text-">
<p>
Why I implement this application.
</p>


</article>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1">Traditional way to connect to SSH server</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<pre class="example">
coldnew@gentoo ~ $ ssh coldnew@192.168.20.100
The authenticity of host '192.168.20.100 (192.168.20.100)' can't be established.
ECDSA key fingerprint is SHA256:izC+HeDEm/u1FcCzpM+aBgpbuGlrGD1HkMnwLVkS+ac.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.20.100' (ECDSA) to the list of known hosts.
Password:
</pre>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2">Connect to SSH server without password</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li><p>
You can use <code>ssh-copy-id</code> to make ssh without password
</p>

<pre class="example">
coldnew@gentoo ~ $ ssh-copy-id ~/.ssh/id_rsa.pub coldnew@192.168.20.100
Password:
</pre></li>

<li><p>
Now it's no need to type any password to login
</p>

<pre class="example">
coldnew@gentoo ~ $ ssh coldnew@192.168.20.100
Warning: Permanently added '192.168.20.100' (ECDSA) to the list of known hosts.
coldnew@pc ~ $
</pre></li>
</ul>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3">Use password vs without password</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>password

<ul>
<li>Your server may not be secure</li>

<li>Brute force attack</li>
</ul></li>

<li>without password

<ul>
<li>You need to setup key first to let user login</li>

<li>System may be not easy to mantain but more secure</li>
</ul></li>
</ul>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4">The Soultion: Google Authenticator</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/g2fa-auth-setup.gif" alt="g2fa-auth-setup.gif" width="80%" />
</p>
</div>
</article>


</article>

</slide>

</slide>

</slide>
<slide id="sec-" class=" segue dark quote nobackground" style="background-image: url(nil)">
<aside class="gdbar right bottom"><img src="images/telegram-icon.png"></aside><hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline9" class="outline-2">
<h2 id="orgheadline9">But&#x2026;</h2>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="flexbox vleft auto-fadein" id="text-">
<p>
What if we don't trust Google ?
</p>


</article>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6">Google said: Don't be evil</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/Dontbeevil.jpg" alt="Dontbeevil.jpg" />
</p>
</div>
</article>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7">Eat you own dogfood</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/eat.jpg" alt="eat.jpg" width="40%" />
</p>
</div>
</article>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8">Here's what I have done</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/ssh1.png" alt="ssh1.png" width="90%" />
</p>
</div>
</article>


</article>

</slide>

</slide>

</slide>
<slide id="sec-" class=" segue dark quote nobackground" style="background-image: url(nil)">
<aside class="gdbar right bottom"><img src="images/telegram-icon.png"></aside><hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline12" class="outline-2">
<h2 id="orgheadline12">So&#x2026;</h2>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="flexbox vleft auto-fadein" id="text-">
<p>
Let's talk about telegram-authenticator
</p>


</article>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10">What's telegram ?</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>Is a brand new instant-messanger application</li>

<li><p>
Client is open source, but server isn't
</p>

<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/stats-msg-tg.jpg" alt="stats-msg-tg.jpg" width="60%" />
</p>
</div>
</article></li>
</ul>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11">Telegram support BOT</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/tbot.png" alt="tbot.png" width="70%" />
</p>
</div>
</article>


</article>

</slide>

</slide>
</slide>
<slide id="sec-" class=" segue dark quote nobackground" style="background-image: url(nil)">
<aside class="gdbar right bottom"><img src="images/telegram-icon.png"></aside><hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline18" class="outline-2">
<h2 id="orgheadline18">How to create telegram bot ?</h2>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="flexbox vleft auto-fadein" id="text-">


</article>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13">Add botfather to your channel</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">

<div class="figure">
<p><img src="images/b1.png" alt="b1.png" width="50%" />
</p>
</div>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14">Use commands to control your own bot</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">

<div class="figure">
<p><img src="images/b2.png" alt="b2.png" width="50%" />
</p>
</div>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15">Create new bot</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">

<div class="figure">
<p><img src="images/b3.png" alt="b3.png" width="50%" />
</p>
</div>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16">Create new bot</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">

<div class="figure">
<p><img src="images/b4.png" alt="b4.png" width="50%" />
</p>
</div>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline17" class="outline-3">
<h3 id="orgheadline17">Now we know our bot token</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<pre class="example">
239551761:AAFRfD7iN-YTC1o5od8y0IMnFbg-fWdkG4I
</pre>


</article>

</slide>

</slide>

</slide>
<slide id="sec-" class=" segue dark quote nobackground" style="background-image: url(nil)">
<aside class="gdbar right bottom"><img src="images/telegram-icon.png"></aside><hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline28" class="outline-2">
<h2 id="orgheadline28">A simple guide on botAPI</h2>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="flexbox vleft auto-fadein" id="text-">
<p>
And you'll know how to write a bot
</p>


</article>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline19" class="outline-3">
<h3 id="orgheadline19">Telegram's botAPI</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li><p>
All list in this page
</p>

<p>
<a href="https://core.telegram.org/bots/api">https://core.telegram.org/bots/api</a>
</p></li>

<li>We only talk about how to fetch/send message here</li>

<li>Before this, add bot to your channel</li>
</ul>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline20" class="outline-3">
<h3 id="orgheadline20">Add bot to channel</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">

<div class="figure">
<p><img src="images/b5.png" alt="b5.png" width="50%" />
</p>
</div>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline21" class="outline-3">
<h3 id="orgheadline21">Add bot to channel</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">

<div class="figure">
<p><img src="images/b6.png" alt="b6.png" width="50%" />
</p>
</div>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline22" class="outline-3">
<h3 id="orgheadline22">Add bot to channel</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">

<div class="figure">
<p><img src="images/b7.png" alt="b7.png" width="50%" />
</p>
</div>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline23" class="outline-3">
<h3 id="orgheadline23">Getting updates</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>You cant get update from</li>
</ul>

<div class="org-src-container">

<pre class="prettyprint" data-lang="sh">
https://api.telegram.org/bot$<span style="color: #aadddd;">{</span><span style="color: #aaccff;">TOKEN</span><span style="color: #aadddd;">}</span>/getUpdates
</pre>

</div>

<ul>
<li>So&#x2026; our bot token is</li>
</ul>

<pre class="example">
239551761:AAFRfD7iN-YTC1o5od8y0IMnFbg-fWdkG4I
</pre>

<ul>
<li>And the bot message can get from</li>
</ul>

<pre class="example">
https://api.telegram.org/bot239551761:AAFRfD7iN-YTC1o5od8y0IMnFbg-fWdkG4I/getUpdates
</pre>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline24" class="outline-3">
<h3 id="orgheadline24">Here's what we get after you type something</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<div class="org-src-container">

<pre class="prettyprint" data-lang="json">
<span style="color: #aadddd;">{</span> <span style="color: #aaffaa;">"ok"</span>:<span style="color: #ccaaff;">true</span>,
   <span style="color: #aaffaa;">"result"</span>:<span style="color: #81d4fa;">[</span> <span style="color: #aaccff;">{</span>
         <span style="color: #aaffaa;">"update_id"</span>:<span style="color: #ccaaff;">556578430</span>,
         <span style="color: #aaffaa;">"message"</span>:<span style="color: #aaeecc;">{</span>
            <span style="color: #aaffaa;">"message_id"</span>:<span style="color: #ccaaff;">2</span>,
            <span style="color: #aaffaa;">"from"</span>:<span style="color: #ccaaff;">{</span>
               <span style="color: #aaffaa;">"id"</span>:<span style="color: #ccaaff;">81660412</span>,
               <span style="color: #aaffaa;">"first_name"</span>:<span style="color: #aadddd;">"Yen-Chin"</span>,
               <span style="color: #aaffaa;">"last_name"</span>:<span style="color: #aadddd;">"Lee"</span>,
               <span style="color: #aaffaa;">"username"</span>:<span style="color: #aadddd;">"coldnew"</span> <span style="color: #ccaaff;">}</span>,
            <span style="color: #aaffaa;">"chat"</span>:<span style="color: #ccaaff;">{</span>
               <span style="color: #aaffaa;">"id"</span>:<span style="color: #ccaaff;">81660412</span>,
               <span style="color: #aaffaa;">"first_name"</span>:<span style="color: #aadddd;">"Yen-Chin"</span>,
               <span style="color: #aaffaa;">"last_name"</span>:<span style="color: #aadddd;">"Lee"</span>,
               <span style="color: #aaffaa;">"username"</span>:<span style="color: #aadddd;">"coldnew"</span>,
               <span style="color: #aaffaa;">"type"</span>:<span style="color: #aadddd;">"private"</span> <span style="color: #ccaaff;">}</span>,   <span style="color: #aaffaa;">"date"</span>:<span style="color: #ccaaff;">1473738006</span>,  <span style="color: #aaffaa;">"text"</span>:<span style="color: #aadddd;">"test"</span> <span style="color: #aaeecc;">}</span> <span style="color: #aaccff;">}</span>, <span style="color: #81d4fa;">]</span> <span style="color: #aadddd;">}</span>
</pre>

</div>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline25" class="outline-3">
<h3 id="orgheadline25">The chat_id is the room id</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>chat_id: <code>8166042</code></li>
</ul>

<div class="org-src-container">

<pre class="prettyprint" data-lang="json">
<span style="color: #aadddd;">{</span><span style="color: #aaffaa;">"update_id"</span>:<span style="color: #ccaaff;">556578430</span>,
 <span style="color: #aaffaa;">"message"</span>:<span style="color: #81d4fa;">{</span>
     <span style="color: #aaffaa;">"message_id"</span>:<span style="color: #ccaaff;">2</span>,
     <span style="color: #aaffaa;">"from"</span>:<span style="color: #aaccff;">{</span>
         <span style="color: #aaffaa;">"id"</span>:<span style="color: #ccaaff;">81660412</span>,
         <span style="color: #aaffaa;">"first_name"</span>:<span style="color: #aadddd;">"Yen-Chin"</span>,
         <span style="color: #aaffaa;">"last_name"</span>:<span style="color: #aadddd;">"Lee"</span>,
         <span style="color: #aaffaa;">"username"</span>:<span style="color: #aadddd;">"coldnew"</span> <span style="color: #aaccff;">}</span>,
     <span style="color: #aaffaa;">"chat"</span>:<span style="color: #aaccff;">{</span>
         <span style="color: #aaffaa;">"id"</span>:<span style="color: #ccaaff;">81660412</span>,
         <span style="color: #aaffaa;">"first_name"</span>:<span style="color: #aadddd;">"Yen-Chin"</span>,
         <span style="color: #aaffaa;">"last_name"</span>:<span style="color: #aadddd;">"Lee"</span>,
         <span style="color: #aaffaa;">"username"</span>:<span style="color: #aadddd;">"coldnew"</span>,
         <span style="color: #aaffaa;">"type"</span>:<span style="color: #aadddd;">"private"</span> <span style="color: #aaccff;">}</span>,   <span style="color: #aaffaa;">"date"</span>:<span style="color: #ccaaff;">1473738006</span>,  <span style="color: #aaffaa;">"text"</span>:<span style="color: #aadddd;">"test"</span> <span style="color: #81d4fa;">}</span> <span style="color: #aadddd;">}</span>
</pre>

</div>


</article>

</slide>
</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline26" class="outline-3">
<h3 id="orgheadline26">Send message to bot channel</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>Now you find the chat_id, you can send message to specific channel</li>

<li>Use following url to do it</li>
</ul>

<div class="org-src-container">

<pre class="prettyprint" data-lang="sh">
https://api.telegram.org/bot$<span style="color: #aadddd;">{</span><span style="color: #aaccff;">TOKEN</span><span style="color: #aadddd;">}</span>/sendMessage
</pre>

</div>

<ul>
<li>So&#x2026; in this example, we has this url</li>
</ul>

<pre class="example">
https://api.telegram.org/bot239551761:AAFRfD7iN-YTC1o5od8y0IMnFbg-fWdkG4I/sendMessage
</pre>

<ul>
<li>You need to add parameter to specify chat_id and text</li>
</ul>

<div class="org-src-container">

<pre class="prettyprint" data-lang="json">
<span style="color: #aadddd;">{</span><span style="color: #aaffaa;">"chat_id"</span>: <span style="color: #aadddd;">"81660412"</span>,
 <span style="color: #aaffaa;">"text"</span>: <span style="color: #aadddd;">"Hello telegram bot"</span><span style="color: #aadddd;">}</span>
</pre>

</div>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline27" class="outline-3">
<h3 id="orgheadline27">Let's try it with curl command</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<div class="org-src-container">

<pre class="prettyprint" data-lang="sh">
curl -s <span style="color: #aadddd;">\</span>
     -X POST <span style="color: #aadddd;">\</span>
     https://api.telegram.org/bot239551761:AAFRfD7iN-YTC1o5od8y0IMnFbg-fWdkG4I/sendMessage <span style="color: #aadddd;">\</span>
     -d <span style="color: #aaccff;">text</span>=<span style="color: #aadddd;">"Hello telegram bot"</span> <span style="color: #aadddd;">\</span>
     -d <span style="color: #aaccff;">chat_id</span>=<span style="color: #ccaaff;">81660412</span>
</pre>

</div>


<div class="figure">
<p><img src="images/tx1.png" alt="tx1.png" width="30%" />
</p>
</div>


</article>

</slide>

</slide>
</slide>
<slide id="sec-" class=" segue dark quote nobackground" style="background-image: url(nil)">
<aside class="gdbar right bottom"><img src="images/telegram-icon.png"></aside><hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline33" class="outline-2">
<h2 id="orgheadline33">Writing pam_module</h2>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="flexbox vleft auto-fadein" id="text-">


</article>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline29" class="outline-3">
<h3 id="orgheadline29">What's pam ?</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>PAM (Pluggable Authentication Modules)</li>

<li><p>
Use for user authentication in any modern linux distribution
</p>

<br></li>

<li>For more info on how to write pam_module, please see

<ul>
<li><a href="http://www.linux-pam.org/Linux-PAM-html/Linux-PAM_MWG.html">The Linux-PAM Module Writers' Guide</a></li>
</ul></li>
</ul>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline30" class="outline-3">
<h3 id="orgheadline30">A simple hello world example</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="smaller" id="text-">
<ul>
<li>pam_hello.c</li>
</ul>

<div class="org-src-container">

<pre class="prettyprint" data-lang="c">
<span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">stdio.h</span><span style="color: #aadddd;">&gt;</span>
<span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">stdlib.h</span><span style="color: #aadddd;">&gt;</span>
<span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">syslog.h</span><span style="color: #aadddd;">&gt;</span>
<span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">security/pam_modules.h</span><span style="color: #aadddd;">&gt;</span>
<span style="color: #ff8888;">#include</span> <span style="color: #aadddd;">&lt;</span><span style="color: #aadddd;">security/pam_ext.h</span><span style="color: #aadddd;">&gt;</span>

PAM_EXTERN <span style="color: #fff59d;">int</span> <span style="color: #aaccff;">pam_sm_authenticate</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">pam_handle_t</span>* <span style="color: #aaccff;">pamh</span>, <span style="color: #fff59d;">int</span> <span style="color: #aaccff;">flags</span>, <span style="color: #fff59d;">int</span> <span style="color: #aaccff;">argc</span>,
                                   <span style="color: #fff59d;">char</span> <span style="color: #aaffaa;">const</span>** <span style="color: #aaccff;">argv</span><span style="color: #aadddd;">)</span> <span style="color: #aadddd;">{</span>
        pam_info<span style="color: #81d4fa;">(</span>pamh, <span style="color: #aadddd;">"Hello there!!"</span><span style="color: #81d4fa;">)</span>;
        <span style="color: #aaffaa;">return</span> PAM_IGNORE;
<span style="color: #aadddd;">}</span>

PAM_EXTERN <span style="color: #fff59d;">int</span> <span style="color: #aaccff;">pam_sm_setcred</span><span style="color: #aadddd;">(</span><span style="color: #fff59d;">pam_handle_t</span>* <span style="color: #aaccff;">pamh</span>, <span style="color: #fff59d;">int</span> <span style="color: #aaccff;">flags</span>, <span style="color: #fff59d;">int</span> <span style="color: #aaccff;">argc</span>,
                              <span style="color: #fff59d;">char</span> <span style="color: #aaffaa;">const</span>** <span style="color: #aaccff;">argv</span><span style="color: #aadddd;">)</span> <span style="color: #aadddd;">{</span>
        <span style="color: #aaffaa;">return</span> PAM_SUCCESS;
<span style="color: #aadddd;">}</span>
</pre>

</div>

<ul>
<li>Compile with</li>
</ul>

<pre class="example">
gcc pam_hello.c -fPIC -lpam -shared -o pam_hello.so
</pre>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline31" class="outline-3">
<h3 id="orgheadline31">Move the pam_hello.so to it's place</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li><p>
In my system, it's /lib/security
</p>

<pre class="example">
sudo mv pam_hello.so /lib/security/
</pre></li>

<li><p>
Modify <code>/etc/pam.d/sshd</code>
</p>

<pre class="example">
auth       required     pam_hello.so
</pre></li>

<li><p>
Modify <code>/etc/ssh/sshd_config</code>
</p>

<pre class="example">
ChallengeResponseAuthentication yes
</pre></li>
</ul>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline32" class="outline-3">
<h3 id="orgheadline32">Now, let's test it</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li><p>
Remember to restart sshd first
</p>

<pre class="example">
sudo systemctl rstart sshd
</pre></li>

<li><p>
Test ssh login
</p>

<pre class="example">
coldnew@pc ~ $ ssh coldnew@192.168.20.100
Password:
Hello there!!
coldnew@gentoo ~ $
</pre></li>
</ul>


</article>

</slide>

</slide>
</slide>
<slide id="sec-" class=" segue dark quote nobackground" style="background-image: url(nil)">
<aside class="gdbar right bottom"><img src="images/telegram-icon.png"></aside><hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline39" class="outline-2">
<h2 id="orgheadline39">The Project</h2>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="flexbox vleft auto-fadein" id="text-">
<p>
telegram-authenticator
</p>


</article>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline34" class="outline-3">
<h3 id="orgheadline34">It's in alpha but almost worked</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>GitHub: <a href="https://github.com/coldnew/telegram-authenticator">https://github.com/coldnew/telegram-authenticator</a></li>

<li>Need to update the documentation</li>

<li>All codes write in <code>C</code></li>
</ul>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline35" class="outline-3">
<h3 id="orgheadline35">How to use it</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>Installed it like what we installed pam_hello.so</li>

<li><p>
Move the lib to /lib/security
</p>

<pre class="example">
sudo mv pam_telegram_authenticator.so /lib/security/
</pre></li>

<li><p>
Modify <code>/etc/pam.d/sshd</code>
</p>

<pre class="example">
auth       required     pam_telegram_authenticator.so
</pre></li>

<li><p>
Modify <code>/etc/ssh/sshd_config</code>
</p>

<pre class="example">
ChallengeResponseAuthentication yes
</pre></li>
</ul>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline36" class="outline-3">
<h3 id="orgheadline36">Use userspace application to save bot info</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<pre class="example">
coldnew@gentoo ~ $ telegram-authenticator
Please enter your telegram bot token:
239551761:AAFRfD7iN-YTC1o5od8y0IMnFbg-fWdkG4I
Please type '/start' to your telegram bot
Waiting for user type '/start' in telegram bot channel

Find chat_id: 81660412

Do you want to write setting to your config? (y/n) y
</pre>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline37" class="outline-3">
<h3 id="orgheadline37">After your setup, this application will send info to telegram</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">

<div class="figure">
<p><img src="images/cx1.png" alt="cx1.png" width="50%" />
</p>
</div>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline38" class="outline-3">
<h3 id="orgheadline38">And &#x2026; you'll get this result</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<article class="flexbox vcenter">

<div class="figure">
<p><img src="images/ssh1.png" alt="ssh1.png" width="90%" />
</p>
</div>
</article>


</article>

</slide>

</slide>

</slide>
<slide id="sec-" class=" segue dark quote nobackground" style="background-image: url(nil)">
<aside class="gdbar right bottom"><img src="images/telegram-icon.png"></aside><hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline43" class="outline-2">
<h2 id="orgheadline43">The missing part</h2>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="flexbox vleft auto-fadein" id="text-">
<p>
A little guide on json-c
</p>


</article>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline40" class="outline-3">
<h3 id="orgheadline40">In this project, we use json-c</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>To parse json info</li>

<li>Mix with curl to send json info</li>
</ul>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline41" class="outline-3">
<h3 id="orgheadline41">How to use json-c</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<ul>
<li>Our target</li>
</ul>

<div class="org-src-container">

<pre class="prettyprint" data-lang="json">
<span style="color: #aadddd;">{</span> <span style="color: #aaffaa;">"ok"</span>:<span style="color: #ccaaff;">true</span>,
  <span style="color: #aaffaa;">"result"</span>:<span style="color: #81d4fa;">[</span> <span style="color: #aaccff;">{</span> <span style="color: #aaffaa;">"update_id"</span>:<span style="color: #ccaaff;">556578430</span>,
               <span style="color: #aaffaa;">"message"</span>:<span style="color: #aaeecc;">{</span> <span style="color: #aaffaa;">"message_id"</span>:<span style="color: #ccaaff;">2</span>, <span style="color: #aaffaa;">"chat"</span>:<span style="color: #ccaaff;">{</span> <span style="color: #aaffaa;">"id"</span>:<span style="color: #ccaaff;">81660412</span> <span style="color: #ccaaff;">}</span>  <span style="color: #aaffaa;">"text"</span>:<span style="color: #aadddd;">"test"</span> <span style="color: #aaeecc;">}</span><span style="color: #aaccff;">}</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">}</span>
</pre>

</div>

<ul>
<li>Parse result</li>
</ul>

<div class="org-src-container">

<pre class="prettyprint" data-lang="c">
<span style="color: #fff59d;">json_object</span> *<span style="color: #aaccff;">root</span> = json_tokener_parse<span style="color: #aadddd;">(</span>DATA<span style="color: #aadddd;">)</span>;
<span style="color: #fff59d;">json_object</span> *<span style="color: #aaccff;">body</span>;
json_object_object_get_ex<span style="color: #aadddd;">(</span>root, <span style="color: #aadddd;">"result"</span>, &amp;body<span style="color: #aadddd;">)</span>;

<span style="color: #5f5f5f; font-style: italic;">// </span><span style="color: #9ac; font-style: italic;">print it</span>
printf<span style="color: #aadddd;">(</span><span style="color: #aadddd;">"result: %s</span><span style="color: #ccaaff;">\</span><span style="color: #ff8888;">n</span><span style="color: #aadddd;">"</span>, json_object_to_json_string<span style="color: #81d4fa;">(</span>body<span style="color: #81d4fa;">)</span><span style="color: #aadddd;">)</span>;
</pre>

</div>


</article>

</slide>

</slide>
<slide id="sec-"  >
<hgroup class="">
       <h2 class=" "><div id="outline-container-orgheadline42" class="outline-3">
<h3 id="orgheadline42">How to user json-c on array</h3>
</div>
</h2>
       <h3></h3>
       </hgroup>
<article class="" id="text-">
<div class="org-src-container">

<pre class="prettyprint" data-lang="json">
<span style="color: #aadddd;">{</span> <span style="color: #aaffaa;">"result"</span>:<span style="color: #81d4fa;">[</span> <span style="color: #aaccff;">{</span><span style="color: #aaffaa;">"message"</span>:<span style="color: #aaeecc;">{</span> <span style="color: #aaffaa;">"message_id"</span>:<span style="color: #ccaaff;">2</span>, <span style="color: #aaffaa;">"chat"</span>:<span style="color: #ccaaff;">{</span> <span style="color: #aaffaa;">"id"</span>:<span style="color: #ccaaff;">81660412</span> <span style="color: #ccaaff;">}</span>  <span style="color: #aaffaa;">"text"</span>:<span style="color: #aadddd;">"test"</span> <span style="color: #aaeecc;">}</span><span style="color: #aaccff;">}</span><span style="color: #81d4fa;">]</span><span style="color: #aadddd;">}</span>
</pre>

</div>

<div class="org-src-container">

<pre class="prettyprint" data-lang="c">
<span style="color: #fff59d;">json_object</span> *<span style="color: #aaccff;">root</span> = json_tokener_parse<span style="color: #aadddd;">(</span>DATA<span style="color: #aadddd;">)</span>;
<span style="color: #fff59d;">json_object</span> *<span style="color: #aaccff;">body</span>;
json_object_object_get_ex<span style="color: #aadddd;">(</span>root, <span style="color: #aadddd;">"result"</span>, &amp;body<span style="color: #aadddd;">)</span>;
<span style="color: #fff59d;">int</span> <span style="color: #aaccff;">arraylen</span> = json_object_array_length<span style="color: #aadddd;">(</span>body<span style="color: #aadddd;">)</span>;
<span style="color: #fff59d;">json_object</span> *<span style="color: #aaccff;">jvalue</span>;
<span style="color: #aaffaa;">for</span> <span style="color: #aadddd;">(</span><span style="color: #fff59d;">int</span> <span style="color: #aaccff;">i</span> = <span style="color: #ccaaff;">0</span>; i &lt; arraylen; i++<span style="color: #aadddd;">)</span> <span style="color: #aadddd;">{</span>
        jvalue = json_object_array_get_idx<span style="color: #81d4fa;">(</span>body, i<span style="color: #81d4fa;">)</span>;

        <span style="color: #aaffaa;">struct</span> <span style="color: #fff59d;">json_object</span> *<span style="color: #aaccff;">jchat</span>;
        json_object_object_get_ex<span style="color: #81d4fa;">(</span>jmessage, <span style="color: #aadddd;">"chat"</span>, &amp;jchat<span style="color: #81d4fa;">)</span>;

        <span style="color: #aaffaa;">struct</span> <span style="color: #fff59d;">json_object</span> *<span style="color: #aaccff;">jchat_id</span>;
        json_object_object_get_ex<span style="color: #81d4fa;">(</span>jchat, <span style="color: #aadddd;">"id"</span>, &amp;jchat_id<span style="color: #81d4fa;">)</span>;
<span style="color: #aadddd;">}</span>
</pre>

</div>


</article>

</slide>

</slide>
</slide>
<slide id="sec-" class=" thank-you-slide segue nobackground" style="background-image: url(nil)">
<aside class="gdbar right"><img src="images/telegram-icon.png"></aside><article class="flexbox vleft auto-fadein" id="text-">
<h2>
  <p>Thank You</p>
</h2>
<br>
<p class="auto-fadein" data-config-contact>
</p>
</article>

</slide>
<slide class="backdrop"></slide>
</slides> 
<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body> 

</html>
